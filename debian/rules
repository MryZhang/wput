#!/usr/bin/make -f

PACKAGE = wput

include debian/debian-vars.mk
include debian/debian-autotools.mk
include debian/debian-save-restore.mk

# Original sources modified by build process
FILE_LIST_PRESERVE = \
 doc/wdel.1~ \
 doc/wput.1~ \
 config.status \
 Makefile \
 po/Makefile \
 po/Makefile.in \
 src/Makefile \
 src/config.h

include /usr/share/dpkg/buildflags.mk
CFLAGS	+= -Wall -pedantic
LDFLAGS += -Wl,--as-needed
export CFLAGS LDFLAGS

# _XOPEN_SOURCE is needed for
# ftp-ls.c:851: warning: implicit declaration of function 'strptime'
CFLAGS_EXTRA = -D_XOPEN_SOURCE=600 $(CFLAGS)

override_dh_auto_configure:
	$(config-save)
	$(config-patch)
	dh_auto_configure

override_dh_auto_build:
	$(MAKE) -C src CFLAGS_EXTRA="$(CFLAGS_EXTRA)"
	$(MAKE) -C po

override_dh_install:
	dh_install
	$(config-restore)
	$(file-state-restore-copy)

override_dh_clean:
	$(file-state-save)
	dh_clean

%:
	dh $@

# End of file
